{% extends 'base.html' %}
{% load static %}

{% block title %}文章归档 - {{ config.SITE_NAME }}{% endblock %}

{% block content %}
<div class="min-h-[80vh] px-4 py-16 md:py-24 bg-base-100 relative overflow-hidden">
    
    <!-- Background Decoration -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none select-none">
        <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-primary/5 rounded-full blur-[100px] opacity-50"></div>
        <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-secondary/5 rounded-full blur-[100px] opacity-50"></div>
    </div>

    <div class="max-w-4xl mx-auto relative z-10">
        <!-- Hero Section -->
        <div class="text-center mb-16 space-y-4">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-base-200/50 border border-base-content/5 text-xs font-medium text-base-content/60 mb-4 backdrop-blur-sm">
                <span class="material-symbols-outlined text-[16px]">history</span>
                <span>时光轴</span>
            </div>
            
            <h1 class="text-4xl md:text-5xl font-bold font-heading tracking-tight">
                文章归档
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">.</span>
            </h1>
            <p class="text-lg text-base-content/60 max-w-2xl mx-auto">
                共 <span class="font-bold text-base-content">{{ posts|length }}</span> 篇文章，记录成长的足迹。
            </p>
        </div>

        {% regroup posts by published_at_fallback.year as year_list %}

        <div class="relative">
            <!-- Vertical Line (Desktop) -->
            <div class="absolute left-8 md:left-1/2 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-base-content/10 to-transparent hidden md:block"></div>

            <ul class="space-y-12">
                {% for year in year_list %}
                <li class="relative">
                    <!-- Year Marker -->
                    <div class="flex md:justify-center items-center mb-8 sticky top-20 z-20">
                        <div class="bg-base-100 border border-base-content/10 shadow-lg px-6 py-2 rounded-full backdrop-blur-md">
                            <span class="text-2xl font-bold font-mono bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">{{ year.grouper }}</span>
                        </div>
                    </div>

                    <div class="space-y-6">
                        {% for post in year.list %}
                        <div class="flex flex-col md:flex-row items-center gap-6 group">
                            <!-- Date (Desktop: Alternating) -->
                            <div class="w-full md:w-1/2 flex md:justify-end {% if forloop.counter|divisibleby:2 %}md:order-1 md:text-right{% else %}md:order-3 md:text-left{% endif %}">
                                <div class="hidden md:flex flex-col gap-1 opacity-60 group-hover:opacity-100 transition-opacity">
                                    <span class="text-sm font-mono font-bold">{{ post.published_at_fallback|date:"m-d" }}</span>
                                    <span class="text-xs">{{ post.published_at_fallback|date:"l" }}</span>
                                </div>
                            </div>

                            <!-- Dot -->
                            <div class="relative flex items-center justify-center md:order-2 shrink-0">
                                <div class="w-4 h-4 rounded-full bg-base-300 border-2 border-base-100 ring-1 ring-base-content/10 group-hover:bg-primary group-hover:ring-primary/30 transition-all duration-300 z-10"></div>
                                <div class="absolute w-px h-full bg-base-content/10 md:hidden left-1/2 -translate-x-1/2 -z-10"></div>
                            </div>

                            <!-- Content Card -->
                            <div class="w-full md:w-1/2 pl-8 md:pl-0 {% if forloop.counter|divisibleby:2 %}md:order-3{% else %}md:order-1{% endif %}">
                                <a href="{{ post.get_absolute_url }}" class="block card bg-base-100 border border-base-content/5 hover:border-primary/20 shadow-sm hover:shadow-xl transition-all duration-300 group-hover:-translate-y-1 overflow-hidden">
                                    <div class="card-body p-5">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="md:hidden text-xs font-mono opacity-50">{{ post.published_at_fallback|date:"m-d" }}</span>
                                            {% if post.category %}
                                            <span class="badge badge-xs md:badge-sm badge-ghost group-hover:bg-primary/10 group-hover:text-primary transition-colors">
                                                {{ post.category.name }}
                                            </span>
                                            {% endif %}
                                        </div>
                                        
                                        <h3 class="card-title text-base md:text-lg group-hover:text-primary transition-colors">
                                            {{ post.title }}
                                        </h3>
                                        
                                        {% if post.tags.exists %}
                                        <div class="flex flex-wrap gap-1.5 mt-3 opacity-60 group-hover:opacity-100 transition-opacity">
                                            {% for tag in post.tags.all|slice:":3" %}
                                            <span class="text-[10px] px-1.5 py-0.5 rounded bg-base-200/50 text-base-content/60">#{{ tag.name }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </li>
                {% empty %}
                <li class="text-center py-20">
                    <div class="inline-flex flex-col items-center justify-center p-8 rounded-3xl bg-base-200/30 border border-dashed border-base-content/10">
                        <span class="material-symbols-outlined text-5xl text-base-content/20 mb-4">history_toggle_off</span>
                        <h3 class="text-lg font-bold opacity-60">暂无历史文章</h3>
                        <p class="text-sm opacity-40 mt-1">开始创作，记录第一笔足迹吧！</p>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}
