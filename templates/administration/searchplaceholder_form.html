{% extends "administration/base.html" %}
{% load capture_tags widget_tweaks i18n %}

{% block title %}{{ title }}{{ config.SITE_ADMIN_SUFFIX|default:" - Rosetta Dashboard" }}{% endblock %}

{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            form.addEventListener('submit', function(e) {
                // Sync text field
                const textInput = document.getElementById('id_text_zh_hans');
                const baseTextInput = document.getElementById('id_text');
                if (textInput && baseTextInput) {
                    baseTextInput.value = textInput.value;
                }
            });
        });
    </script>
{% endblock %}

{% block content %}
<form method="post" enctype="multipart/form-data" class="grid grid-cols-1 lg:grid-cols-3 gap-6" novalidate>
    {% csrf_token %}
    
    <!-- Left Column: Main Content -->
    <div class="lg:col-span-2 space-y-6">
        <div class="card bg-base-100 shadow-sm border border-base-content/5">
            <div class="card-body p-6">
                <h2 class="card-title text-lg mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">manage_search</span>
                    {% trans "åŸºæœ¬ä¿¡æ¯" %}
                </h2>
                
                {% if form.non_field_errors %}
                <div role="alert" class="alert border border-error/20 bg-error/5 text-error mb-4 shadow-sm">
                    <div class="flex items-start gap-4">
                        <span class="material-symbols-outlined pt-1">error</span>
                        <div class="w-full">
                            <span class="font-bold block mb-1">{% trans "è¡¨å•é”™è¯¯" %}</span>
                            <ul class="list-disc list-inside text-sm opacity-90">
                                {% for error in form.non_field_errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Multi-language Tabs -->
                <div x-data="translationForm" class="bg-base-100 border border-base-300 rounded-box overflow-hidden">
                    <!-- Tab Header -->
                    <div class="flex flex-wrap items-center justify-between gap-2 border-b border-base-200 bg-base-50/50 px-4 pt-2">
                        <div role="tablist" class="tabs tabs-bordered -mb-[1px]">
                            <a role="tab" class="tab h-10 px-4 transition-all duration-200"
                               :class="activeTab === 'zh-hans' ? 'tab-active border-primary text-primary font-bold bg-base-100' : 'hover:text-base-content/80'"
                               @click="activeTab = 'zh-hans'">
                                <span class="mr-2 text-lg">ğŸ‡¨ğŸ‡³</span>
                                {% trans "ä¸­æ–‡" %}
                            </a>
                            <a role="tab" class="tab h-10 px-4 transition-all duration-200"
                               :class="activeTab === 'en' ? 'tab-active border-primary text-primary font-bold bg-base-100' : 'hover:text-base-content/80'"
                               @click="activeTab = 'en'">
                                <span class="mr-2 text-lg">ğŸ‡ºğŸ‡¸</span>
                                English
                            </a>
                            <a role="tab" class="tab h-10 px-4 transition-all duration-200"
                               :class="activeTab === 'ja' ? 'tab-active border-primary text-primary font-bold bg-base-100' : 'hover:text-base-content/80'"
                               @click="activeTab = 'ja'">
                                <span class="mr-2 text-lg">ğŸ‡¯ğŸ‡µ</span>
                                æ—¥æœ¬èª
                            </a>
                            <a role="tab" class="tab h-10 px-4 transition-all duration-200"
                               :class="activeTab === 'zh-hant' ? 'tab-active border-primary text-primary font-bold bg-base-100' : 'hover:text-base-content/80'"
                               @click="activeTab = 'zh-hant'">
                                <span class="mr-2 text-lg">ğŸ‡­ğŸ‡°</span>
                                ç¹é«”ä¸­æ–‡
                            </a>
                        </div>

                        <!-- One-click Translate Button -->
                        <div class="mb-1">
                            <button type="button" 
                                    class="btn btn-sm btn-ghost gap-1.5 text-primary hover:bg-primary/10 transition-colors"
                                    @click="translate('id_text_zh_hans', {
                                        'en': 'id_text_en',
                                        'ja': 'id_text_ja',
                                        'zh-hant': 'id_text_zh_hant'
                                    })"
                                    :class="{'loading': isLoading}"
                                    title="{% trans 'è‡ªåŠ¨ç¿»è¯‘åˆ°å…¶ä»–è¯­è¨€' %}">
                                <span class="material-symbols-outlined text-[18px]" x-show="!isLoading">translate</span>
                                <span class="hidden sm:inline font-medium">{% trans "ä¸€é”®ç¿»è¯‘" %}</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tab Content -->
                    <div class="p-6">
                        <!-- Zh-Hans Tab -->
                        <div x-show="activeTab === 'zh-hans'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-1" x-transition:enter-end="opacity-100 translate-y-0">
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text font-bold text-base">{% trans "å…³é”®è¯å†…å®¹ (ä¸­æ–‡)" %} <span class="text-error">*</span></span>
                                </label>
                                {% trans "è¾“å…¥æœç´¢æ¡†æç¤ºæ–‡å­— (ä¸­æ–‡)" as ph_zh %}
                                {% render_field form.text_zh_hans class="input input-bordered w-full focus:input-primary transition-all" placeholder=ph_zh %}
                                {% if form.text_zh_hans.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.text_zh_hans.errors.0 }}</span>
                                </label>
                                {% endif %}
                            </div>
                        </div>

                        <!-- English Tab -->
                        <div x-show="activeTab === 'en'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-1" x-transition:enter-end="opacity-100 translate-y-0" style="display: none;">
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text font-bold text-base">Placeholder Text (English)</span>
                                </label>
                                {% trans "Enter placeholder text (English)" as ph_en %}
                                {% render_field form.text_en class="input input-bordered w-full focus:input-primary transition-all" placeholder=ph_en %}
                                {% if form.text_en.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.text_en.errors.0 }}</span>
                                </label>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Japanese Tab -->
                        <div x-show="activeTab === 'ja'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-1" x-transition:enter-end="opacity-100 translate-y-0" style="display: none;">
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text font-bold text-base">ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ (Japanese)</span>
                                </label>
                                {% trans "ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ› (Japanese)" as ph_ja %}
                                {% render_field form.text_ja class="input input-bordered w-full focus:input-primary transition-all" placeholder=ph_ja %}
                                {% if form.text_ja.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.text_ja.errors.0 }}</span>
                                </label>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Zh-Hant Tab -->
                        <div x-show="activeTab === 'zh-hant'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-1" x-transition:enter-end="opacity-100 translate-y-0" style="display: none;">
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text font-bold text-base">é—œéµè©å…§å®¹ (Traditional Chinese)</span>
                                </label>
                                {% trans "è¼¸å…¥æœç´¢æ¡†æç¤ºæ–‡å­— (ç¹é«”ä¸­æ–‡)" as ph_tw %}
                                {% render_field form.text_zh_hant class="input input-bordered w-full focus:input-primary transition-all" placeholder=ph_tw %}
                                {% if form.text_zh_hant.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.text_zh_hant.errors.0 }}</span>
                                </label>
                                {% endif %}
                                <label class="label">
                                    <span class="label-text-alt text-base-content/60">{% trans "è¿™å°†ä½œä¸ºæœç´¢æ¡†çš„ placeholder å±æ€§æ˜¾ç¤ºã€‚" %}</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Hidden inputs for content and base fields -->
                <div class="hidden">
                    {{ form.text }} <!-- Base text -->
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Sidebar -->
    <div class="lg:col-span-1 space-y-6">
        <!-- Publish Box -->
        <div class="card bg-base-100 shadow-sm border border-base-content/5 sticky top-24">
            <div class="card-body p-4">
                <h3 class="font-bold text-sm text-base-content/70 uppercase tracking-wider mb-4 border-b border-base-200 pb-2">{% trans "å‘å¸ƒ" %}</h3>
                
                <div class="flex flex-col gap-3">
                    <button type="submit" class="btn btn-primary w-full gap-2 shadow-lg shadow-primary/20">
                        <span class="material-symbols-outlined">save</span>
                        {% trans "ä¿å­˜æ›´æ”¹" %}
                    </button>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button type="submit" name="_addanother" class="btn btn-sm btn-ghost border-base-300">{% trans "ä¿å­˜å¹¶æ–°å¢" %}</button>
                        <button type="submit" name="_continue" class="btn btn-sm btn-ghost border-base-300">{% trans "ä¿å­˜å¹¶ç»§ç»­" %}</button>
                    </div>

                    {% if object %}
                    <div class="divider my-1"></div>
                    <div class="flex justify-between items-center">
                        <a href="javascript:history.back()" class="btn btn-sm btn-ghost text-base-content/60">{% trans "å–æ¶ˆ" %}</a>
                        {% blocktrans asvar delete_msg %}ç¡®å®šè¦åˆ é™¤å…³é”®è¯ã€Š{{ object.text|escapejs }}ã€‹å—ï¼Ÿ{% endblocktrans %}
                        <button type="button" onclick="confirmDelete('{% url 'administration:searchplaceholder_delete' object.pk %}', '{{ delete_msg|escapejs }}')" class="btn btn-sm btn-ghost text-error hover:bg-error/10">
                            {% trans "åˆ é™¤" %}
                        </button>
                    </div>
                    {% else %}
                    <div class="divider my-1"></div>
                    <a href="javascript:history.back()" class="btn btn-sm btn-ghost text-base-content/60 w-full">{% trans "å–æ¶ˆ" %}</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Status Box -->
        <div class="card bg-base-100 shadow-sm border border-base-content/5">
            <div class="card-body p-4">
                <h3 class="font-bold text-sm text-base-content/70 uppercase tracking-wider mb-4 border-b border-base-200 pb-2">{% trans "çŠ¶æ€è®¾ç½®" %}</h3>
                
                <div class="form-control">
                    <label class="label cursor-pointer justify-between">
                        <span class="label-text font-medium">{% trans "å¯ç”¨æ˜¾ç¤º" %}</span>
                        {% render_field form.is_active class="toggle toggle-success" %}
                    </label>
                </div>

                <div class="divider my-2"></div>

                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text font-medium">{% trans "æ’åºæƒé‡" %}</span>
                    </label>
                    {% render_field form.order class="input input-bordered w-full focus:input-primary transition-all" type="number" %}
                    <label class="label">
                        <span class="label-text-alt text-base-content/60">{% trans "æ•°å­—è¶Šå°è¶Šé å‰ (é»˜è®¤ 0)" %}</span>
                    </label>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}
