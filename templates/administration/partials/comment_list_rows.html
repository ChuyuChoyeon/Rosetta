{% load i18n %}
{% for comment in comments %}
    <tr class="hover">
        <th class="pl-6">
            <label>
                <input type="checkbox"
                       name="selected_ids"
                       value="{{ comment.pk }}"
                       class="checkbox checkbox-xs rounded-sm row-checkbox"
                       onchange="updateBulkToolbar()" />
            </label>
        </th>
        <th class="font-mono text-xs opacity-50 hidden md:table-cell">{{ comment.id }}</th>
        <td class="max-w-[300px]">
            <div class="flex items-start gap-3">
                <div class="avatar mt-1 shrink-0">
                    <div class="w-8 h-8 rounded-full ring ring-base-200 ring-offset-1">
                        <img src="{{ comment.user.get_avatar_url }}"
                             alt="{{ comment.user.username }}" />
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                        <a href="{% url 'administration:user_edit' comment.user.pk %}"
                           class="font-bold text-sm hover:text-primary transition-colors truncate">{{ comment.user.nickname|default:comment.user.username }}</a>
                        {% if comment.user.is_staff %}
                            <span class="badge badge-primary badge-xs gap-0.5"
                                  title="{% trans '管理员' %}">
                                <span class="material-symbols-outlined text-[10px]">verified</span>
                                <span class="hidden xl:inline">{% trans "管理员" %}</span>
                            </span>
                        {% endif %}
                        {% if comment.user.title %}
                            <span class="badge badge-xs gap-0.5 {% if not comment.user.title.color|first == '#' %}badge-{{ comment.user.title.color }}{% endif %}"
                                  style="{% if comment.user.title.color|first == '#' %}background-color: {{ comment.user.title.color }};
                                         border-color: {{ comment.user.title.color }};
                                         color: white;
                                         {% endif %}"
                                  title="{{ comment.user.title.name }}">
                                {% if comment.user.title.icon %}
                                    <span class="w-2.5 h-2.5 flex items-center justify-center [&>svg]:w-full [&>svg]:h-full">{{ comment.user.title.icon|safe }}</span>
                                {% else %}
                                    <span class="material-symbols-outlined text-[10px]">verified</span>
                                {% endif %}
                                <span class="hidden xl:inline">{{ comment.user.title.name }}</span>
                            </span>
                        {% endif %}
                        <span class="text-xs text-base-content/40 lg:hidden">{{ comment.created_at|date:"m-d" }}</span>
                    </div>
                    {% if comment.parent %}
                        <div class="text-xs text-base-content/60 flex items-center gap-1 mt-0.5 mb-1 bg-base-200/50 p-1 rounded w-fit max-w-full truncate">
                            <span class="material-symbols-outlined text-[10px] rotate-180">reply</span>
                            {% trans "回复" %} <span class="font-medium">{{ comment.parent.user.nickname|default:comment.parent.user.username }}</span>: {{ comment.parent.content|truncatechars:20 }}
                        </div>
                    {% endif %}
                    <a href="{% url 'administration:comment_edit' comment.pk %}"
                       class="text-sm text-base-content/80 line-clamp-2 break-all hover:text-primary transition-colors block mt-0.5"
                       title="{% trans '编辑评论' %}">{{ comment.content }}</a>
                </div>
            </div>
        </td>
        <td class="text-right hidden lg:table-cell">
            <div class="flex flex-col items-end gap-1">
                <a href="{% url 'post_detail' comment.post.slug %}"
                   target="_blank"
                   class="text-xs font-medium hover:text-primary transition-colors line-clamp-1 max-w-[150px]"
                   title="{{ comment.post.title }}">{{ comment.post.title }}</a>
                <span class="text-[10px] text-base-content/40 font-mono"
                      title="{{ comment.created_at }}">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
            </div>
        </td>
        <td class="text-center hidden sm:table-cell whitespace-nowrap">
            {% if comment.active %}
                <div class="badge badge-success badge-sm gap-1 badge-outline bg-success/5 border-success/30">
                    <span class="w-1.5 h-1.5 rounded-full bg-success"></span>
                    {% trans "已发布" %}
                </div>
            {% else %}
                <div class="badge badge-warning badge-sm gap-1 badge-outline bg-warning/5 border-warning/30">
                    <span class="w-1.5 h-1.5 rounded-full bg-warning"></span>
                    {% trans "待审核" %}
                </div>
            {% endif %}
        </td>
        <td class="text-right pr-4">
            <div class="join">
                <button type="button"
                        class="btn btn-ghost btn-xs join-item tooltip tooltip-left"
                        data-tip="{% trans '回复' %}"
                        onclick="openReplyModal('{% url 'administration:comment_reply' comment.pk %}', '{{ comment.content|escapejs }}')">
                    <span class="material-symbols-outlined text-base">reply</span>
                </button>
                <a href="{% url 'administration:comment_edit' comment.pk %}"
                   class="btn btn-ghost btn-xs join-item tooltip tooltip-left"
                   data-tip="{% trans '编辑' %}">
                    <span class="material-symbols-outlined text-base">edit</span>
                </a>
                <form action="{% url 'administration:comment_edit' comment.pk %}"
                      method="post"
                      class="inline">
                    {% csrf_token %}
                    <input type="hidden" name="content" value="{{ comment.content }}">
                    <input type="hidden"
                           name="active"
                           value="{% if comment.active %}false{% else %}true{% endif %}">
                    <button type="submit"
                            class="btn btn-ghost btn-xs join-item tooltip tooltip-left {% if not comment.active %}text-success{% endif %}"
                            data-tip="{% if comment.active %}{% trans '隐藏' %}{% else %}{% trans '发布' %}{% endif %}">
                        {% if comment.active %}
                            <span class="material-symbols-outlined text-base">visibility_off</span>
                        {% else %}
                            <span class="material-symbols-outlined text-base">check_circle</span>
                        {% endif %}
                    </button>
                </form>
                <button type="button"
                        hx-post="{% url 'administration:comment_delete' comment.pk %}"
                        hx-trigger="confirmed"
                        hx-target="closest tr"
                        hx-swap="outerHTML swap:0.5s"
                        onclick="confirmHtmx(this, '{% trans "确定要删除这条评论吗？"|escapejs %}')"
                        class="btn btn-ghost btn-xs join-item text-error tooltip tooltip-left"
                        data-tip="{% trans '删除' %}">
                    <span class="material-symbols-outlined text-base">delete</span>
                </button>
            </div>
        </td>
    </tr>
{% empty %}
    <tr>
        <td colspan="6" class="text-center py-10 text-base-content/50">
            <div class="flex flex-col items-center gap-2">
                <span class="material-symbols-outlined text-4xl opacity-20">mark_chat_unread</span>
                <span>{% trans "暂无评论" %}</span>
            </div>
        </td>
    </tr>
{% endfor %}
