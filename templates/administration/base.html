{% load static tailwind_tags i18n core_extras django_htmx %}
<!DOCTYPE html>
<html lang="zh-hans">
    <head>
        {% include 'meta/meta.html' %}
        <script>
            // --- 全局配置 ---
            // 如果用户已登录，设置主题更新 URL，供 theme.js 调用
            {% if user.is_authenticated %}
            window.USER_PREFERENCE_URL = "{% url 'users:update_theme' %}";
            {% endif %}
        </script>
        <!-- Admin Core (No Build Dependency) - Must load before body -->
        <!-- 主题初始化 (防闪烁) -->
        {% include 'partials/theme_init.html' %}
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon"
              href="{{ config.SITE_FAVICON|default:'/static/theme/img/favicon.ico' }}">
        <title>
            {% block title %}
                {% trans "Rosetta Dashboard" as admin_site_header_default %}{{ config.SITE_HEADER|default:admin_site_header_default }}
            {% endblock title %}
        </title>
        {% tailwind_css %}
        <!-- NProgress & PageLoader -->
        <script src="{% static 'theme/js/nprogress.js' %}"></script>
        <link rel="stylesheet" href="{% static 'theme/css/nprogress.css' %}" />
        <script src="{% static 'js/page-loader.js' %}"></script>
        <script src="{% static 'theme/js/theme.js' %}"></script>
        <!-- Alpine.js -->
        <script defer src="{% static 'theme/js/alpine.min.js' %}"></script>
        <!-- HTMX -->
        <script src="{% static 'theme/js/htmx.min.js' %}"></script>
        <script>
            // HTMX Debug
            if (window.htmx) {
                console.log("[HTMX] Loaded successfully. Version:", htmx.version);
                // htmx.logAll(); // Uncomment to see all HTMX events
            } else {
                console.error("[HTMX] Failed to load!");
            }
        </script>
        <script src="{% static 'js/htmx-init.js' %}?v=5.0"></script>
        <!-- Global UI Helpers -->
        <script src="{% static 'js/ui-helpers.js' %}?v=5.0.0"></script>
        <script src="{% static 'js/admin-translation.js' %}"></script>
        <!-- ApexCharts -->
        <script src="{% static 'theme/js/apexcharts.min.js' %}"></script>
        <!-- Editor Styles & Scripts (Only loaded when needed) -->
        <link rel="stylesheet" href="{% static 'js/editor.css' %}?v=4.1">
        <script defer src="{% static 'js/editor.js' %}?v=4.1"></script>
        <!-- Cropper.js -->
        <script src="{% static 'js/image-cropper.js' %}"></script>
        {% block extra_head %}{% endblock extra_head %}
    <!-- Admin Command Palette Data -->
    <script>
        window.ROSETTA_COMMANDS = [
 { id: 'dashboard', title: '{% trans "管理后台首页"|escapejs %}', icon: 'dashboard', url: '{% url 'administration:index' %}', group: '{% trans "导航"|escapejs %}', keywords: '{% trans "首页 概览 仪表盘"|escapejs %}' },
{ id: 'posts', title: '{% trans "文章列表"|escapejs %}', icon: 'article', url: '{% url 'administration:post_list' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "文章 内容 列表"|escapejs %}' },
{ id: 'new_post', title: '{% trans "新建文章"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:post_create' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "文章 新建 新增 写作"|escapejs %}' },
{ id: 'categories', title: '{% trans "分类列表"|escapejs %}', icon: 'category', url: '{% url 'administration:category_list' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "分类 列表"|escapejs %}' },
{ id: 'category_create', title: '{% trans "新建分类"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:category_create' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "分类 新建 新增"|escapejs %}' },
{ id: 'category_export', title: '{% trans "导出分类"|escapejs %}', icon: 'download', url: '{% url 'administration:category_export' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "分类 导出"|escapejs %}' },
{ id: 'category_import', title: '{% trans "导入分类"|escapejs %}', icon: 'upload', url: '{% url 'administration:category_import' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "分类 导入"|escapejs %}' },
{ id: 'tags', title: '{% trans "标签列表"|escapejs %}', icon: 'label', url: '{% url 'administration:tag_list' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "标签 列表"|escapejs %}' },
{ id: 'tag_create', title: '{% trans "新建标签"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:tag_create' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "标签 新建 新增"|escapejs %}' },
{ id: 'comments', title: '{% trans "评论列表"|escapejs %}', icon: 'comment', url: '{% url 'administration:comment_list' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "评论 审核 列表"|escapejs %}' },
{ id: 'pages', title: '{% trans "页面列表"|escapejs %}', icon: 'description', url: '{% url 'administration:page_list' %}', group: '{% trans "页面"|escapejs %}', keywords: '{% trans "单页 页面 列表"|escapejs %}' },
{ id: 'page_create', title: '{% trans "新建页面"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:page_create' %}', group: '{% trans "页面"|escapejs %}', keywords: '{% trans "页面 新建 新增"|escapejs %}' },
{ id: 'navigation', title: '{% trans "导航管理"|escapejs %}', icon: 'menu', url: '{% url 'administration:navigation_list' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "导航 菜单 列表"|escapejs %}' },
{ id: 'navigation_create', title: '{% trans "新建导航"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:navigation_create' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "导航 新建 新增"|escapejs %}' },
{ id: 'navigation_export', title: '{% trans "导出导航"|escapejs %}', icon: 'download', url: '{% url 'administration:navigation_export' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "导航 导出"|escapejs %}' },
{ id: 'navigation_import', title: '{% trans "导入导航"|escapejs %}', icon: 'upload', url: '{% url 'administration:navigation_import' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "导航 导入"|escapejs %}' },
{ id: 'polls', title: '{% trans "投票列表"|escapejs %}', icon: 'poll', url: '{% url 'administration:poll_list' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "投票 问卷 列表"|escapejs %}' },
{ id: 'poll_create', title: '{% trans "新建投票"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:poll_create' %}', group: '{% trans "内容"|escapejs %}', keywords: '{% trans "投票 新建 新增"|escapejs %}' },
{ id: 'friendlinks', title: '{% trans "友情链接管理"|escapejs %}', icon: 'link', url: '{% url 'administration:friendlink_list' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "友链 列表"|escapejs %}' },
{ id: 'friendlink_create', title: '{% trans "新建友情链接"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:friendlink_create' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "友链 新建 新增"|escapejs %}' },
{ id: 'friendlink_export', title: '{% trans "导出友情链接"|escapejs %}', icon: 'download', url: '{% url 'administration:friendlink_export' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "友链 导出"|escapejs %}' },
{ id: 'friendlink_import', title: '{% trans "导入友情链接"|escapejs %}', icon: 'upload', url: '{% url 'administration:friendlink_import' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "友链 导入"|escapejs %}' },
{ id: 'placeholders', title: '{% trans "搜索占位符"|escapejs %}', icon: 'manage_search', url: '{% url 'administration:searchplaceholder_list' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "搜索 占位符 列表"|escapejs %}' },
{ id: 'placeholder_create', title: '{% trans "新建搜索占位符"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:searchplaceholder_create' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "占位符 新建 新增"|escapejs %}' },
{ id: 'placeholder_export', title: '{% trans "导出搜索占位符"|escapejs %}', icon: 'download', url: '{% url 'administration:searchplaceholder_export' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "占位符 导出"|escapejs %}' },
{ id: 'placeholder_import', title: '{% trans "导入搜索占位符"|escapejs %}', icon: 'upload', url: '{% url 'administration:searchplaceholder_import' %}', group: '{% trans "外观"|escapejs %}', keywords: '{% trans "占位符 导入"|escapejs %}' },
{ id: 'users', title: '{% trans "用户列表"|escapejs %}', icon: 'group', url: '{% url 'administration:user_list' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户 列表"|escapejs %}' },
{ id: 'user_create', title: '{% trans "新建用户"|escapejs %}', icon: 'person_add', url: '{% url 'administration:user_create' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户 新建 新增"|escapejs %}' },
{ id: 'user_export', title: '{% trans "导出用户"|escapejs %}', icon: 'download', url: '{% url 'administration:user_export' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户 导出"|escapejs %}' },
{ id: 'user_import', title: '{% trans "导入用户"|escapejs %}', icon: 'upload', url: '{% url 'administration:user_import' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户 导入"|escapejs %}' },
{ id: 'usertitle', title: '{% trans "用户称号"|escapejs %}', icon: 'badge', url: '{% url 'administration:usertitle_list' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "称号 头衔 列表"|escapejs %}' },
{ id: 'usertitle_create', title: '{% trans "新建用户称号"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:usertitle_create' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "称号 新建 新增"|escapejs %}' },
{ id: 'usertitle_export', title: '{% trans "导出用户称号"|escapejs %}', icon: 'download', url: '{% url 'administration:usertitle_export' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "称号 导出"|escapejs %}' },
{ id: 'usertitle_import', title: '{% trans "导入用户称号"|escapejs %}', icon: 'upload', url: '{% url 'administration:usertitle_import' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "称号 导入"|escapejs %}' },
{ id: 'groups', title: '{% trans "用户组管理"|escapejs %}', icon: 'groups', url: '{% url 'administration:group_list' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户组 列表"|escapejs %}' },
{ id: 'group_create', title: '{% trans "新建用户组"|escapejs %}', icon: 'add_circle', url: '{% url 'administration:group_create' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户组 新建 新增"|escapejs %}' },
{ id: 'group_export', title: '{% trans "导出用户组"|escapejs %}', icon: 'download', url: '{% url 'administration:group_export' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户组 导出"|escapejs %}' },
{ id: 'group_import', title: '{% trans "导入用户组"|escapejs %}', icon: 'upload', url: '{% url 'administration:group_import' %}', group: '{% trans "用户与权限"|escapejs %}', keywords: '{% trans "用户组 导入"|escapejs %}' },
{ id: 'logentry', title: '{% trans "操作日志"|escapejs %}', icon: 'history', url: '{% url 'administration:logentry_list' %}', group: '{% trans "日志"|escapejs %}', keywords: '{% trans "审计 日志 操作记录"|escapejs %}' },
{ id: 'logentry_export', title: '{% trans "导出操作日志"|escapejs %}', icon: 'download', url: '{% url 'administration:logentry_export' %}', group: '{% trans "日志"|escapejs %}', keywords: '{% trans "日志 导出"|escapejs %}' },
{ id: 'logfile', title: '{% trans "系统日志"|escapejs %}', icon: 'description', url: '{% url 'administration:logfile_list' %}', group: '{% trans "日志"|escapejs %}', keywords: '{% trans "系统 日志 文件"|escapejs %}' },
{ id: 'system_tools', title: '{% trans "系统工具"|escapejs %}', icon: 'build_circle', url: '{% url 'administration:system_tools' %}', group: '{% trans "系统工具"|escapejs %}', keywords: '{% trans "系统 维护 索引 图片"|escapejs %}' },
{ id: 'settings', title: '{% trans "站点设置"|escapejs %}', icon: 'settings', url: '{% url 'administration:settings' %}', group: '{% trans "系统工具"|escapejs %}', keywords: '{% trans "设置 配置 参数"|escapejs %}' },
{ id: 'debug_permission', title: '{% trans "调试 权限检查"|escapejs %}', icon: 'security', url: '{% url 'administration:debug_permission' %}', group: '{% trans "调试"|escapejs %}', keywords: '{% trans "调试 权限"|escapejs %}' },
{ id: 'debug_cache', title: '{% trans "调试 缓存状态"|escapejs %}', icon: 'memory', url: '{% url 'administration:debug_cache' %}', group: '{% trans "调试"|escapejs %}', keywords: '{% trans "调试 缓存"|escapejs %}' },
{ id: 'debug_email', title: '{% trans "调试 邮件发送"|escapejs %}', icon: 'mail', url: '{% url 'administration:debug_email' %}', group: '{% trans "调试"|escapejs %}', keywords: '{% trans "调试 邮件"|escapejs %}' },
{ id: 'profile', title: '{% trans "个人资料"|escapejs %}', icon: 'person', url: '{% url 'users:profile' %}', group: '{% trans "账户"|escapejs %}', keywords: '{% trans "资料 账户"|escapejs %}' },
{ id: 'logout', title: '{% trans "退出登录"|escapejs %}', icon: 'logout', url: '{% url 'users:logout' %}', group: '{% trans "账户"|escapejs %}', keywords: '{% trans "登出 退出"|escapejs %}' },
{ id: 'site', title: '{% trans "查看站点"|escapejs %}', icon: 'public', url: '/', group: '{% trans "外部"|escapejs %}', keywords: '{% trans "前台 站点 首页"|escapejs %}' } 
];
    </script>
    </head>
    <!-- FontAwesome (Required by Toast UI) -->
    <link rel="stylesheet" href="{% static 'theme/css/all.min.css' %}">
    <!-- Local Material Symbols -->
    <style>
        [x-cloak] { display: none !important; }
        @font-face {
            font-family: 'Material Symbols Outlined';
            font-style: normal;
            font-weight: 100 700;
            font-display: swap;
            src: url("{% static 'theme/fonts/MaterialSymbolsOutlined.woff2' %}") format('woff2');
        }
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
    </style>
    <!-- Toast UI Editor -->
    <link rel="stylesheet"
          href="{% static 'theme/css/toastui-editor.min.css' %}" />
    <link rel="stylesheet"
          href="{% static 'theme/css/toastui-editor-dark.min.css' %}" />
    <link rel="stylesheet" href="{% static 'theme/css/editor-overrides.css' %}" />
    <script src="{% static 'theme/js/toastui-editor-all.min.js' %}"></script></head>
<body class="min-h-screen flex flex-col scrollbar-thin scrollbar-thumb-base-300 scrollbar-track-base-100 {% if debug %}debug-screens{% endif %}"
      hx-boost="true"
      hx-ext="class-tools"
      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    <!-- Inspira UI: Neural Background -->
    {% include "components/inspira/neural_background.html" %}
    <!-- Navbar -->
    <div class="navbar bg-base-100/80 backdrop-blur-md shadow-sm border-b border-base-content/5 z-40 sticky top-0 flex-col lg:flex-row lg:justify-between h-auto lg:h-16 py-0 lg:py-0 transition-all duration-300">
        <!-- Mobile Wrapper -->
        <div class="w-full flex items-center justify-between lg:w-auto px-2 lg:px-0 h-14 lg:h-auto">
            <!-- Left: Drawer Button (Mobile) -->
            <div class="lg:hidden">
                <label for="my-drawer-2" class="btn btn-square btn-ghost drawer-button">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         fill="none"
                         viewBox="0 0 24 24"
                         class="inline-block w-6 h-6 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </label>
            </div>

            <!-- Center: Logo & Title -->
            <div class="flex-1 flex justify-center lg:justify-start lg:flex-none">
                <a href="{% url 'administration:index' %}"
                   class="normal-case text-lg lg:text-xl flex items-center gap-2 lg:gap-3 font-bold text-base-content hover:opacity-80 transition-opacity">
                    {% if config.SHOW_SITE_LOGO and config.SITE_LOGO %}
                        <img src="{{ config.SITE_LOGO }}"
                             alt="Admin Logo"
                             class="h-7 lg:h-8 w-auto object-contain"
                             width="32"
                             height="32">
                    {% else %}
                        <div class="w-7 h-7 lg:w-8 lg:h-8 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                            <span class="material-symbols-outlined text-lg lg:text-xl">admin_panel_settings</span>
                        </div>
                    {% endif %}
                    {% trans "Rosetta Admin" as admin_title %}
                    <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent font-extrabold tracking-tight hidden sm:inline-block">{{ config.ADMIN_NAVBAR_TITLE|default:admin_title }}</span>
                </a>
            </div>

            <!-- Right: Mobile Actions -->
            <div class="flex items-center gap-0 lg:hidden">
                <button type="button"
                        class="btn btn-ghost btn-circle btn-sm"
                        onclick="window.openCommandPalette && window.openCommandPalette(event)">
                    <span class="material-symbols-outlined text-xl">search</span>
                </button>
                
                <!-- Mobile User Avatar -->
                <div class="dropdown dropdown-end ml-0.5">
                    <div tabindex="0"
                         role="button"
                         class="btn btn-ghost btn-circle avatar btn-sm">
                        <div class="w-7 h-7 rounded-full ring ring-primary ring-offset-base-100 ring-offset-1">
                            <img alt="{{ request.user.username }}"
                                 src="{{ request.user.get_avatar_url }}"
                                 width="28"
                                 height="28" />
                        </div>
                    </div>
                    <ul tabindex="0"
                        class="mt-3 z-50 p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52 border border-base-content/10">
                        <li>
                            <a href="{% url 'users:profile' %}" hx-boost="false">{% trans "个人资料" %}</a>
                        </li>
                        <li>
                            <label class="justify-between">
                                {% trans "深色模式" %}
                                <input type="checkbox" class="toggle toggle-xs theme-controller" value="dark" onchange="updateTheme(this.checked ? 'dark' : 'light')"/>
                            </label>
                        </li>
                        <li>
                            <a href="{% url 'users:logout' %}" hx-boost="false" class="text-error">{% trans "退出登录" %}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Desktop Actions (Hidden on Mobile) -->
        <div class="hidden lg:flex flex-none gap-2 items-center">
            <a href="{% url 'home' %}"
               target="_blank"
               class="btn btn-ghost btn-sm"
               hx-boost="false">
                {% trans "查看站点" %}
                <svg xmlns="http://www.w3.org/2000/svg"
                     fill="none"
                     viewBox="0 0 24 24"
                     class="w-4 h-4 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14">
                    </path>
                </svg>
            </a>
            <!-- Language Switcher (Desktop) -->
            {% get_current_language as LANGUAGE_CODE %}
            {% get_available_languages as LANGUAGES %}
            <div class="dropdown dropdown-end">
                <div tabindex="0"
                     role="button"
                     class="btn btn-ghost btn-circle hover:bg-primary/10 hover:text-primary transition-colors">
                    <span class="material-symbols-outlined text-[24px]">translate</span>
                </div>
                <ul tabindex="0"
                    class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
                    {% for lang_code, lang_name in LANGUAGES %}
                        <li>
                            <a href="{% translate_url lang_code %}"
                               class="{% if lang_code == LANGUAGE_CODE %}active{% endif %}">{{ lang_name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <button type="button"
                    class="input input-sm input-bordered flex items-center gap-2 w-80 bg-base-100/70 hover:bg-base-100 transition-all text-left cursor-text"
                    onclick="window.openCommandPalette && window.openCommandPalette(event)">
                <span class="material-symbols-outlined text-base text-base-content/50">search</span>
                <span class="text-sm text-base-content/60 truncate">{% trans "搜索命令或页面…" %}</span>
                <div class="ml-auto flex items-center gap-1 text-[10px] text-base-content/50 shrink-0">
                    <kbd class="h-5 px-1.5 rounded border border-base-content/20 bg-base-100">Ctrl</kbd>
                    <kbd class="h-5 px-1.5 rounded border border-base-content/20 bg-base-100">K</kbd>
                </div>
            </button>
            <!-- Theme Switcher -->
            <label class="swap swap-rotate btn btn-ghost btn-circle hover:bg-primary/10 hover:text-primary transition-colors">
                <!-- this hidden checkbox controls the state -->
                <input type="checkbox"
                       class="theme-controller hidden"
                       value="dark"
                       onchange="updateTheme(this.checked ? 'dark' : 'light')"
                       id="theme-toggle-admin" />
                <!-- sun icon -->
                <span class="material-symbols-outlined swap-off text-[20px] w-5 h-5 leading-none">light_mode</span>
                <!-- moon icon -->
                <span class="material-symbols-outlined swap-on text-[20px] w-5 h-5 leading-none">dark_mode</span>
            </label>
            <!-- User Dropdown -->
            <div class="dropdown dropdown-end ml-2 z-50">
                <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                    <div class="w-10 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                        <img alt="{{ request.user.nickname|default:request.user.username }}"
                             src="{{ request.user.get_avatar_url }}"
                             width="40"
                             height="40" />
                    </div>
                </div>
                <ul tabindex="0"
                    class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">
                    <li class="menu-title px-4 py-2 bg-base-200/50 rounded-t-box -mx-2 -mt-2 mb-1 border-b border-base-200">
                        <div class="flex flex-col gap-0.5">
                            <span class="text-base-content font-bold text-lg">{{ request.user.nickname|default:request.user.username }}</span>
                            <span class="text-xs font-normal text-base-content/60">@{{ request.user.username }}</span>
                        </div>
                    </li>
                    <li>
                        <a href="{% url 'users:profile' %}" hx-boost="false">{% trans "个人资料" %}</a>
                    </li>
                    <li>
                        <a href="{% url 'users:logout' %}" hx-boost="false">{% trans "退出登录" %}</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Main Content with Sidebar -->
    <div class="drawer lg:drawer-open flex-1">
        <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
        <div class="drawer-content flex flex-col p-6 pt-20">
            <!-- Page Content -->
            {% include "components/toast.html" %}
            {% block content %}{% endblock content %}
        </div>
        <div class="drawer-side z-50">
            <label for="my-drawer-2" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu p-4 w-64 min-h-full bg-base-100/90 backdrop-blur-lg text-base-content gap-1 border-r border-base-content/5">
                <!-- Sidebar content here -->
                <li class="mb-2">
                    <a href="{% url 'administration:index' %}"
                       class="{% if request.resolver_match.url_name == 'index' %}active bg-primary text-primary-content shadow-lg shadow-primary/20 scale-[1.02]{% else %}hover:bg-base-200 hover:scale-[1.02]{% endif %} transition-all duration-200 rounded-xl py-3 font-medium">
                        <span class="material-symbols-outlined {% if request.resolver_match.url_name == 'index' %}text-primary-content{% else %}text-primary{% endif %}">dashboard</span>
                        {% trans "概览" %}
                    </a>
                </li>
                <li class="menu-title text-xs font-bold uppercase tracking-wider opacity-50 mt-4 mb-2 px-2">{% trans "内容管理" %}</li>
                <li>
                    <a href="{% url 'administration:post_list' %}"
                       class="{% if 'post' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'post' in request.resolver_match.url_name %}text-primary{% else %}text-secondary{% endif %}">article</span>
                        {% trans "文章" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:media_list' %}"
                       class="{% if 'media' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'media' in request.resolver_match.url_name %}text-primary{% else %}text-secondary{% endif %}">perm_media</span>
                        {% trans "媒体库" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:category_list' %}"
                       class="{% if 'category' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'category' in request.resolver_match.url_name %}text-primary{% else %}text-secondary{% endif %}">category</span>
                        {% trans "分类" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:tag_list' %}"
                       class="{% if 'tag' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'tag' in request.resolver_match.url_name %}text-primary{% else %}text-secondary{% endif %}">label</span>
                        {% trans "标签" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:comment_list' %}"
                       class="{% if 'comment' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5 justify-between">
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined {% if 'comment' in request.resolver_match.url_name %}text-primary{% else %}text-secondary{% endif %}">comment</span>
                            {% trans "评论" %}
                        </div>
                        {% if pending_comments > 0 %}
                            <span class="badge badge-sm badge-error animate-pulse">{{ pending_comments }}</span>
                        {% endif %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:poll_list' %}"
                       class="{% if 'poll' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'poll' in request.resolver_match.url_name %}text-primary{% else %}text-secondary{% endif %}">poll</span>
                        {% trans "投票" %}
                    </a>
                </li>
                <li class="menu-title text-xs font-bold uppercase tracking-wider opacity-50 mt-4 mb-2 px-2">{% trans "页面管理" %}</li>
                <li>
                    <a href="{% url 'administration:page_list' %}"
                       class="{% if 'page' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'page' in request.resolver_match.url_name %}text-primary{% else %}text-accent{% endif %}">description</span>
                        {% trans "页面" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:navigation_list' %}"
                       class="{% if 'navigation' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'navigation' in request.resolver_match.url_name %}text-primary{% else %}text-accent{% endif %}">menu</span>
                        {% trans "导航" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:friendlink_list' %}"
                       class="{% if 'friendlink' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'friendlink' in request.resolver_match.url_name %}text-primary{% else %}text-accent{% endif %}">link</span>
                        {% trans "友情链接" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:searchplaceholder_list' %}"
                       class="{% if 'searchplaceholder' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'searchplaceholder' in request.resolver_match.url_name %}text-primary{% else %}text-accent{% endif %}">manage_search</span>
                        {% trans "搜索占位符" %}
                    </a>
                </li>
                <li class="menu-title text-xs font-bold uppercase tracking-wider opacity-50 mt-4 mb-2 px-2">{% trans "系统管理" %}</li>
                <li>
                    <a href="{% url 'administration:user_list' %}"
                       class="{% if 'user' in request.resolver_match.url_name and 'title' not in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'user' in request.resolver_match.url_name and 'title' not in request.resolver_match.url_name %}text-primary{% else %}text-info{% endif %}">group</span>
                        {% trans "用户" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:usertitle_list' %}"
                       class="{% if 'usertitle' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'usertitle' in request.resolver_match.url_name %}text-primary{% else %}text-info{% endif %}">badge</span>
                        {% trans "称号" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:group_list' %}"
                       class="{% if 'group' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'group' in request.resolver_match.url_name %}text-primary{% else %}text-info{% endif %}">groups</span>
                        {% trans "用户组" %}
                    </a>
                </li>
                <li class="menu-title text-xs font-bold uppercase tracking-wider opacity-50 mt-4 mb-2 px-2">{% trans "日志与审计" %}</li>
                <li>
                    <a href="{% url 'administration:logentry_list' %}"
                       class="{% if 'logentry' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'logentry' in request.resolver_match.url_name %}text-primary{% else %}text-warning{% endif %}">history</span>
                        {% trans "操作日志" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:logfile_list' %}"
                       class="{% if 'logfile' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'logfile' in request.resolver_match.url_name %}text-primary{% else %}text-warning{% endif %}">description</span>
                        {% trans "系统日志" %}
                    </a>
                </li>
                <li class="menu-title text-xs font-bold uppercase tracking-wider opacity-50 mt-4 mb-2 px-2">{% trans "维护与工具" %}</li>
                <li>
                    <a href="{% url 'administration:periodic_task_list' %}"
                       class="{% if 'periodic_task' in request.resolver_match.url_name %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if 'periodic_task' in request.resolver_match.url_name %}text-primary{% else %}text-info{% endif %}">schedule</span>
                        {% trans "定时任务" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:system_tools' %}"
                       class="{% if request.resolver_match.url_name == 'system_tools' %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if request.resolver_match.url_name == 'system_tools' %}text-primary{% else %}text-info{% endif %}">build_circle</span>
                        {% trans "系统工具" %}
                    </a>
                </li>
                <li>
                    <a href="{% url 'administration:settings' %}"
                       class="{% if request.resolver_match.url_name == 'settings' %}active bg-primary/10 text-primary border-l-4 border-primary font-bold{% else %}hover:bg-base-200{% endif %} transition-all duration-200 rounded-r-xl rounded-l-none -ml-4 pl-8 py-2.5">
                        <span class="material-symbols-outlined {% if request.resolver_match.url_name == 'settings' %}text-primary{% else %}text-info{% endif %}">settings</span>
                        {% trans "站点设置" %}
                    </a>
                </li>
                <div class="divider my-4"></div>
                <li>
                    <a href="{% url 'users:logout' %}"
                       class="text-error hover:bg-error/10 transition-colors duration-200 rounded-lg mx-2">
                        <span class="material-symbols-outlined">logout</span>
                        {% trans "退出登录" %}
                    </a>
                </li>
            </ul>
        </div>
    </div>
    {% block modal %}{% endblock modal %}
    {% include "administration/components/icon_picker_modal.html" %}
    <!-- Footer -->
    <footer class="footer footer-center p-4 bg-base-100 text-base-content border-t border-base-200 mt-auto">
        <div>
            <p class="text-sm opacity-70">
                {% if config.FOOTER_TEXT %}
                    {{ config.FOOTER_TEXT }}
                {% else %}
                    {% trans "Copyright © 2026 - All rights reserved" %}
                {% endif %}
            </p>
        </div>
    </footer>
    <script>
        // Bulk Actions Scripts
        function toggleAll(source) {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = source.checked;
            });
            updateBulkToolbar();
        }

        function updateBulkToolbar() {
            const checkboxes = document.querySelectorAll('.row-checkbox:checked');
            const toolbar = document.getElementById('bulk-actions');
            const countSpan = document.getElementById('selected-count');
            
            if (toolbar) {
                if (checkboxes.length > 0) {
                    toolbar.classList.remove('hidden');
                    countSpan.innerText = checkboxes.length;
                } else {
                    toolbar.classList.add('hidden');
                }
            }
        }

        function submitBulkAction(action) {
            showConfirmModal(
                '{% trans "批量操作"|escapejs %}',
                '{% trans "确定要执行此批量操作吗？"|escapejs %}',
                () => {
                    const form = document.getElementById('bulk-form');
                    const actionInput = document.createElement('input');
                    actionInput.type = 'hidden';
                    actionInput.name = 'action';
                    actionInput.value = action;
                    form.appendChild(actionInput);
                    form.submit();
                }
            );
        }
    </script>
    <!-- Global Modals -->
    {% include "components/confirm_modal.html" %}
    {% block extra_js %}{% endblock extra_js %}
</body>
</html>
