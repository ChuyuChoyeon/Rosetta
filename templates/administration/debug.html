{% extends "administration/debug/base_debug.html" %}
{% load capture_tags %}

{% block debug_title %}概览{% endblock %}

{% block debug_content %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Database Status -->
    {% captureas db_status_card %}
    <div class="h-full p-6 flex flex-col justify-between">
        <h2 class="card-title text-base mb-4">
            <span class="material-symbols-outlined text-secondary">database</span>
            数据库连接
        </h2>
        <div class="flex items-center gap-4">
            {% if db_ok %}
                <div class="radial-progress text-success" style="--value:100; --size:3rem;">100%</div>
                <div>
                    <div class="font-bold text-success">正常 (Connected)</div>
                    <div class="text-xs opacity-50">Latency: < 1ms</div>
                </div>
            {% else %}
                <div class="radial-progress text-error" style="--value:100; --size:3rem;">!</div>
                <div>
                    <div class="font-bold text-error">异常 (Error)</div>
                    <div class="text-xs opacity-50">Check settings</div>
                </div>
            {% endif %}
        </div>
    </div>
    {% endcaptureas %}
    <div class="p-0 overflow-hidden rounded-xl border-none shadow-none hover:shadow-none bg-base-100 border border-base-content/5">
        {{ db_status_card }}
    </div>

    <!-- System Info -->
    {% captureas system_info_card %}
    <div class="h-full p-6 flex flex-col justify-between">
        <h2 class="card-title text-base mb-4">
            <span class="material-symbols-outlined text-info">dns</span>
            系统环境
        </h2>
        <div class="flex flex-col gap-2 text-sm">
            <div class="flex justify-between items-center border-b border-base-content/5 pb-2">
                <span class="opacity-70">Python</span>
                <span class="font-mono font-bold">{{ system_info.python_version }}</span>
            </div>
            <div class="flex justify-between items-center border-b border-base-content/5 pb-2">
                <span class="opacity-70">Django</span>
                <span class="font-mono font-bold">{{ system_info.django_version }}</span>
            </div>
            <div class="flex justify-between items-center pt-1">
                <span class="opacity-70">OS</span>
                <span class="font-mono font-bold truncate max-w-[120px] text-xs" title="{{ system_info.platform }}">{{ system_info.platform }}</span>
            </div>
        </div>
    </div>
    {% endcaptureas %}
    <div class="p-0 overflow-hidden rounded-xl border-none shadow-none hover:shadow-none bg-base-100 border border-base-content/5">
        {{ system_info_card }}
    </div>

    <!-- Data Counts -->
    {% captureas data_counts_card %}
    <div class="p-6">
        <h2 class="card-title text-base mb-4">
            <span class="material-symbols-outlined text-success">dataset</span>
            数据统计
        </h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col p-3 bg-base-200 rounded-lg">
                <span class="text-xs opacity-70">用户</span>
                <span class="text-xl font-bold">{{ counts.users }}</span>
            </div>
            <div class="flex flex-col p-3 bg-base-200 rounded-lg">
                <span class="text-xs opacity-70">文章</span>
                <span class="text-xl font-bold">{{ counts.posts }}</span>
            </div>
            <div class="flex flex-col p-3 bg-base-200 rounded-lg">
                <span class="text-xs opacity-70">评论</span>
                <span class="text-xl font-bold">{{ counts.comments }}</span>
            </div>
        </div>
    </div>
    {% endcaptureas %}
    <div class="p-0 overflow-hidden rounded-xl border-none shadow-none hover:shadow-none bg-base-100 border border-base-content/5">
        {{ data_counts_card }}
    </div>

    <!-- URL Patterns -->
    {% captureas url_patterns_card %}
    <div class="p-0 flex flex-col h-full col-span-1 md:col-span-2 lg:col-span-3">
        <div class="p-6 pb-2 border-b border-base-200">
            <h2 class="card-title flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">link</span>
                系统路由表
            </h2>
            <p class="text-xs text-base-content/50 mt-1">仅显示已命名路由，部分带参数路由不可点击</p>
        </div>
        <div class="overflow-x-auto overflow-y-auto max-h-[600px] p-0 flex-grow scrollbar-thin scrollbar-thumb-base-300">
            <table class="table table-pin-rows table-sm w-full">
                <thead class="bg-base-200 z-30">
                    <tr>
                        <th class="w-5/12 pl-6 min-w-[200px]">路由信息 (Route Info)</th>
                        <th class="w-4/12 min-w-[150px]">功能描述 (Description)</th>
                        <th class="w-3/12 text-right pr-6 min-w-[100px]">操作 (Action)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pattern in url_patterns %}
                    <tr class="hover group border-b border-base-200/50 last:border-none">
                        <td class="pl-6 py-3">
                            <div class="flex flex-col gap-1">
                                <div class="font-bold text-sm text-base-content select-all break-all" title="Route Name: {{ pattern.name }}">
                                    {{ pattern.name }}
                                </div>
                                <div class="font-mono text-xs text-base-content/50 select-all break-all" title="Regex Pattern: {{ pattern.pattern }}">
                                    {{ pattern.display_pattern }}
                                </div>
                            </div>
                        </td>
                        <td class="py-3 align-middle">
                            {% if pattern.description %}
                                <div class="badge badge-ghost badge-sm font-medium h-auto py-1 text-center whitespace-normal">
                                    {{ pattern.description }}
                                </div>
                            {% else %}
                                <span class="text-base-content/30">-</span>
                            {% endif %}
                        </td>
                        <td class="text-right pr-6 align-middle">
                            {% if not pattern.sample_url %}
                                <button class="btn btn-xs btn-disabled btn-ghost opacity-50" title="带参数路由无法直接访问">
                                    <span class="material-symbols-outlined text-base">link_off</span>
                                </button>
                            {% else %}
                                <a href="{{ pattern.sample_url }}" target="_blank" class="btn btn-xs btn-ghost text-primary" title="访问">
                                    <span class="material-symbols-outlined text-base">open_in_new</span>
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endcaptureas %}
    <div class="p-0 overflow-hidden rounded-xl border-none shadow-none hover:shadow-none bg-base-100 border border-base-content/5 col-span-1 md:col-span-2">
        {{ url_patterns_card }}
    </div>
</div>
{% endblock %}