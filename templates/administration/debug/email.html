{% extends "administration/base.html" %}
{% load capture_tags %}
{% load i18n %}
{% block title %}
    {% trans "邮件发送调试" %}{% trans " - Rosetta Dashboard" as admin_suffix_default %}{{ config.SITE_ADMIN_SUFFIX|default:admin_suffix_default }}
{% endblock title %}
{% block content %}
    <!-- Header -->
    {% captureas header_actions %}
        <a href="{% url 'administration:system_tools' %}" class="btn btn-sm btn-ghost gap-2">
            <span class="material-symbols-outlined">arrow_back</span>
            {% trans "返回系统工具" %}
        </a>
    {% endcaptureas %}
    {% trans "邮件发送调试" as title_text %}
    {% trans "测试系统邮件发送功能配置" as subtitle_text %}
    {% include "administration/components/header.html" with title=title_text subtitle=subtitle_text icon="mail" actions=header_actions %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Send Form -->
        <div class="lg:col-span-2 p-6 bg-base-100 rounded-xl border border-base-content/10">
            <h2 class="card-title mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">send</span>
                {% trans "发送测试邮件" %}
            </h2>
            <form method="post" class="space-y-4">
                {% csrf_token %}
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text">{% trans "收件人 (To)" %}</span>
                    </label>
                    <input type="email" name="recipient" class="input input-bordered w-full" placeholder="user@example.com" required />
                </div>
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text">{% trans "主题 (Subject)" %}</span>
                    </label>
                    <input type="text" name="subject" class="input input-bordered w-full" value="[{{ config.SITE_NAME|default:'Rosetta' }}] Test Email" required />
                </div>
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text">{% trans "内容 (Message)" %}</span>
                    </label>
                    <textarea name="message" class="textarea textarea-bordered h-32" required>This is a test email sent from {{ config.SITE_NAME|default:'Rosetta' }} Administration Dashboard.</textarea>
                </div>
                <div class="flex justify-end pt-4">
                    <button type="submit" class="btn btn-primary gap-2">
                        <span class="material-symbols-outlined">send</span>
                        {% trans "发送邮件" %}
                    </button>
                </div>
            </form>
        </div>

        <!-- Config Info -->
        <div class="lg:col-span-1 p-6 bg-base-100 rounded-xl border border-base-content/10 h-fit">
            <h2 class="card-title mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined text-info">settings</span>
                {% trans "邮件配置" %}
            </h2>
            <div class="overflow-x-auto">
                <table class="table w-full">
                    <tbody>
                        <tr>
                            <td class="font-medium">EMAIL_HOST</td>
                            <td class="font-mono text-sm opacity-70">{{ email_host }}</td>
                        </tr>
                        <tr>
                            <td class="font-medium">EMAIL_PORT</td>
                            <td class="font-mono text-sm opacity-70">{{ email_port }}</td>
                        </tr>
                        <tr>
                            <td class="font-medium">EMAIL_HOST_USER</td>
                            <td class="font-mono text-sm opacity-70">{{ email_host_user }}</td>
                        </tr>
                        <tr>
                            <td class="font-medium">EMAIL_USE_TLS</td>
                            <td class="font-mono text-sm opacity-70">
                                {% if email_use_tls %}
                                    <span class="badge badge-success badge-sm">True</span>
                                {% else %}
                                    <span class="badge badge-ghost badge-sm">False</span>
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-4 text-xs opacity-50">
                <p>{% trans "* 仅显示部分非敏感配置信息" %}</p>
            </div>
        </div>
    </div>
{% endblock content %}
