{% extends 'base.html' %}
{% load i18n %}
{% load capture_tags %}
{% block title %}
    {% trans "修改密码" %} - Rosetta
{% endblock %}
{% block content %}
    <div class="container mx-auto px-4 py-8 min-h-[calc(100vh-16rem)] animate-fade-in-up"
         x-data="{ showAvatarModal: false, avatarUrl: '{{ user.get_avatar_url }}' }">
        <div class="flex flex-col md:flex-row gap-8 items-start">
            <!-- Sidebar -->
            <div class="w-full md:w-80 flex-shrink-0 md:sticky md:top-24">
                {% include 'users/includes/profile_card.html' with profile_user=user %}
            </div>
            <!-- Main Content -->
            <div class="flex-1 min-w-0">
                <div class="bg-base-100 shadow-xl border border-base-content/5 rounded-2xl overflow-hidden relative">
                    <!-- Decorative Top Gradient -->
                    <div class="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-primary via-secondary to-accent"></div>
                    <div class="p-8 sm:p-10 min-h-[500px]">
                        <h2 class="card-title text-2xl font-bold font-heading mb-6 flex items-center gap-2">
                            <span class="w-10 h-10 rounded-xl bg-primary/10 text-primary flex items-center justify-center">
                                <span class="material-symbols-outlined">lock</span>
                            </span>
                            {% trans "修改密码" %}
                        </h2>
                        <form method="post" class="space-y-6 max-w-lg">
                            {% csrf_token %}
                            {% for field in form %}
                                <div class="form-control w-full">
                                    <label class="label">
                                        <span class="label-text font-bold">{{ field.label }}</span>
                                    </label>
                                    <div class="relative group">
                                        <input type="{{ field.field.widget.input_type }}"
                                               name="{{ field.name }}"
                                               class="input input-bordered w-full pl-4 pr-10 focus:input-primary transition-all duration-300 rounded-xl bg-base-200/30 focus:bg-base-100 {% if field.errors %}input-error{% endif %}"
                                               {% if field.field.required %}required{% endif %}>
                                        {% if 'password' in field.name %}
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-base-content/40">
                                                <span class="material-symbols-outlined text-[20px]">key</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                    {% if field.help_text %}
                                        <label class="label pt-1">
                                            <span class="label-text-alt text-base-content/50 flex items-start gap-1 leading-tight">
                                                <span class="material-symbols-outlined text-[14px] mt-0.5">info</span>
                                                {{ field.help_text|safe }}
                                            </span>
                                        </label>
                                    {% endif %}
                                    {% for error in field.errors %}
                                        <label class="label pt-1">
                                            <span class="label-text-alt text-error flex items-center gap-1 font-medium">
                                                <span class="material-symbols-outlined text-[14px]">error</span>
                                                {{ error }}
                                            </span>
                                        </label>
                                    {% endfor %}
                                </div>
                            {% endfor %}
                            <div class="card-actions justify-end mt-8">
                                <button type="submit"
                                        class="btn btn-primary text-lg font-bold rounded-xl shadow-lg shadow-primary/20 hover:shadow-primary/40 transition-all duration-300 hover:scale-[1.02] px-8">
                                    <span class="material-symbols-outlined">save</span>
                                    {% trans "保存修改" %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- Avatar Modal -->
        <template x-teleport="body">
            <div x-show="showAvatarModal"
                 class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm transition-opacity duration-300"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 @keydown.escape.window="showAvatarModal = false"
                 style="display: none">
                <button @click="showAvatarModal = false"
                        class="absolute top-4 right-4 btn btn-circle btn-ghost text-white hover:bg-white/20 z-50">
                    <span class="material-symbols-outlined text-3xl">close</span>
                </button>
                <div class="relative w-full h-full flex items-center justify-center p-4"
                     @click.self="showAvatarModal = false">
                    <img :src="avatarUrl"
                         alt="Avatar Fullscreen"
                         class="max-h-[90vh] max-w-[95vw] object-contain rounded-lg shadow-2xl transition-transform duration-300 scale-100"
                         @click.stop />
                </div>
            </div>
        </template>
    </div>
    <!-- Edit Profile Modal -->
    {% include 'users/includes/edit_profile_modal.html' with profile_user=user %}
{% endblock %}
