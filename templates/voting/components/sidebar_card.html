{% load i18n voting_extras cache %}
{% get_active_polls limit=3 as active_polls %}
{% if active_polls %}
    <div class="group bg-base-100 rounded-3xl border border-base-content/5 p-6 hover:border-primary/20 hover:shadow-xl hover:shadow-primary/5 transition-all duration-300">
        <h3 class="font-bold text-lg mb-5 flex items-center gap-2 font-heading">
            <span class="w-8 h-8 rounded-lg bg-primary/10 text-primary flex items-center justify-center">
                <span class="material-symbols-outlined text-lg">poll</span>
            </span>
            {% trans "投票" %}
        </h3>
        <div class="flex flex-col gap-4">
            {% for poll in active_polls %}
                <div class="p-4 bg-base-200/30 rounded-2xl hover:bg-base-200/60 transition-colors">
                    <a href="{% if poll.related_post %}{% url 'post_detail' poll.related_post.slug %}{% else %}#{% endif %}"
                       class="font-bold text-sm mb-2 block hover:text-primary transition-colors">{{ poll.title }}</a>
                    <div class="text-xs text-base-content/60 flex justify-between items-center">
                        <span>{{ poll.total_votes }} {% trans "票" %}</span>
                        {% if user|has_voted:poll %}
                            <span class="badge badge-xs badge-success text-white gap-1">
                                <span class="material-symbols-outlined text-[10px]">check</span>
                                {% trans "已投票" %}
                            </span>
                        {% else %}
                            <span class="badge badge-xs badge-ghost">{% trans "进行中" %}</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}
